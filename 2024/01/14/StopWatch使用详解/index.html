<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>StopWatch使用详解 | 小奥</title><meta name="keywords" content="StopWatch"><meta name="author" content="小奥,3189137314@qq.com"><meta name="copyright" content="小奥"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="StopWatch使用详解"><meta name="application-name" content="StopWatch使用详解"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="StopWatch使用详解"><meta property="og:url" content="http://example.com/2024/01/14/StopWatch%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/index.html"><meta property="og:site_name" content="小奥"><meta property="og:description" content="StopWatch使用详解当我们需要测试代码性能的时候，你是否第一时间快速的敲出如下代码： long start &amp;#x3D; System.currentTimeMillis();      test();      long end &amp;#x3D; System.currentTimeMillis();      S"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://example.com/img/png/7.png"><meta property="article:author" content="小奥"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/png/7.png"><meta name="description" content="StopWatch使用详解当我们需要测试代码性能的时候，你是否第一时间快速的敲出如下代码： long start &amp;#x3D; System.currentTimeMillis();      test();      long end &amp;#x3D; System.currentTimeMillis();      S"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2024/01/14/StopWatch%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 编程知识爱好者","🔍 分享与热心帮助","🏠 面试总结小能手","🔨 设计开发一条龙","🤝 源码阅读与解析","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 小奥","link":"链接: ","source":"来源: 小奥","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '小奥',
  title: 'StopWatch使用详解',
  postAI: '',
  pageFillDescription: 'StopWatch使用详解, 一、认识StopWatch, 1.1 单个任务测试, 1.2 多任务测试并生成统计表, 1.3 优缺点, 二、源码解析, 2.1 成员变量, 2.2 start(), 2.3 stop(), 四、完整源码使用详解当我们需要测试代码性能的时候你是否第一时间快速的敲出如下代码程序执行耗时这样的写法其实并不会有很大的问题只是当我们需要测试的方法比较多或者说交叉测试时就会比较麻烦了比如执行耗时执行耗时执行耗时这样的代码看起来不仅繁琐而且可读性很差所以我今天为大家介绍一个比较好用的计时工具下面让我们一起学习一起早日用起来吧一认识是包下的一个工具类使用它可直观的输出代码执行耗时以及执行时间百分比我们可以从源码注释上看到这个工具类的介绍简单的秒表允许对多个任务进行计时显示总运行时间和每个指定任务的运行时间隐藏的使用提高应用程序代码的可读性减少计算错误的可能性注意这个对象不是被设计为线程安全的也不使用同步该类通常用于在概念验证工作和开发过程中验证性能而不是作为生产应用程序的一部分从开始以纳秒为单位跟踪和报告运行时间从开始字符串呈现的默认时间单位是秒其小数点的精度为纳秒具有特定时间单位的自定义渲染可以通过请求这里有两点是需要我们注意的隐藏的使用提高应用程序代码的可读性减少计算错误的可能性对象不是被设计为线程安全的也不使用同步下面我们来介绍一个这个工具的使用以及会出现的线程安全问题并且如何去解决该问题单个任务测试我们可以调用和方法来开始和结束计时并且通过来获取程序执行耗时这里使用线程休眠来模拟耗时程序程序执行耗时控制台输出结果如下程序执行耗时可以看到这和我们使用是一样的那么有小伙伴就要说了这和直接使用有什么区别吗先别着急让我们继续往下看多任务测试并生成统计表下面我们来看多任务测试并且调用生成统计图表的测试代码这里使用线程休眠来模拟耗时程序这里使用线程休眠来模拟耗时程序控制台输出如下可以看到不仅编写的代码可读性增强了而且控制台输出结果也图表化了更加的直观具体了并且我们也可以给不同的进行命名给不同的命名以便区分不同程序的执行结果测试优缺点优点自带工具类无需三方引入开箱即用使用简单方便结果格式化输出展示每项任务耗时与占用时间百分比结果更加直观可自定义任务名称方便查看结果缺点一个实例一次只能开启一个并且需要等之后才能新的代码侵入式使用注意单线程使用的源码注释中有明确提到注意这个对象不是被设计为线程安全的也不使用同步该类通常用于在概念验证工作和开发过程中验证性能而不是作为生产应用程序的一部分二源码解析下面让我们分析一下的的源码成员变量秒表的标识符当我们有多个秒表的输出并需要在日志或控制台输出中区分它们时这很方便任务列表当前任务的开始时间当前任务的名称任务数量总运行时间方法的逻辑如下首先判断当前的计时任务是否停止标志了计时器是否正在被某个任务占用方法也表明了这一点不为空计时器正在被某个任务占用抛出异常为空计时器重新计时设置当前任务名称设置任务开始时间使用来测量每个耗时启动一个未命名的任务如果在不首先调用此方法的情况下调用或计时方法则结果是未定义的启动一个命名任务如果在不首先调用此方法的情况下调用或计时方法则结果是未定义的将当前时间赋值给注意这里用的是纳秒级别方法的逻辑如下首先判断当前的计时任务是否停止标志了计时器是否正在被某个任务占用方法也表明了这一点不为空有进行中的测量的任务为空没有进行中的测量的任务抛出异常计算计算结束任务构造任务测量结果存放到任务列表中构造对象判断该对象是否拓展集合中是存放在集合中否跳过放弃本次任务收集置为停止当前任务如果在没有调用至少一对方法的情况下调用计时方法则结果是未定义的这里是计算耗时的逻辑四完整源码简单的秒表允许对多个任务进行计时显示总运行时间和每个指定任务的运行时间隐藏的使用提高应用程序代码的可读性减少计算错误的可能性注意这个对象不是被设计为线程安全的也不使用同步该类通常用于在概念验证工作和开发过程中验证性能而不是作为生产应用程序的一部分从开始以纳秒为单位跟踪和报告运行时间从开始字符串呈现的默认时间单位是秒其小数点的精度为纳秒具有特定时间单位的自定义渲染可以通过请求秒表的标识符当我们有多个秒表的输出并需要在日志或控制台输出中区分它们时这很方便当前任务的开始时间当前任务的名称总运行时间构造一个新的秒表不启动任何任务用给定的构造一个新的秒表当我们有多个秒表的输出并需要区分它们时很方便不启动任何任务获取在构造中指定的的配置秒表是否数组是随着时间构建的当使用秒表执行数百万个任务时将此设置为否则结构会占用过多的内存默认为启动一个未命名的任务如果在不首先调用此方法的情况下调用或计时方法则结果是未定义的启动一个命名任务如果在不首先调用此方法的情况下调用或计时方法则结果是未定义的停止当前任务如果在没有调用至少一对方法的情况下调用计时方法则结果是未定义的确定秒表当前是否正在运行获取当前运行任务的名称如果有把最后一个任务作为对象把最后一个任务作为对象弃用从开始支持获取最后一个任务的名称弃用从开始支持可以查看获取最后一个任务花费的时间以纳秒为单位弃用从开始支持可以查看获取最后一个任务所花费的时间以毫秒为单位弃用从开始支持可以查看获取已执行任务的数据数组可以查看获取计时的任务数获取所有任务的总时间以纳秒为单位可以查看获取所有任务的总时间以毫秒为单位可以查看以秒为单位获取所有任务的总时间可以查看以请求的时间单位获取所有任务的总时间以纳秒为精度的小数点生成一个表描述以秒为单位执行的所有任务以纳秒为精度的小数点对于自定义报告调用并直接使用数据生成一个表描述在请求的时间单位内执行的所有任务以纳秒为精度的小数点对于自定义报告调用并直接使用数据获取以秒为单位的总运行时间的简短描述生成一个信息字符串描述在几秒钟内执行的所有任务嵌套类用于保存在中执行的一个任务的数据获取该任务的名称获取此任务花费的时间以纳秒为单位获取此任务花费的时间以豪秒为单位获取此任务花费的时间以秒为单位以请求的时间单位获取此任务所花费的时间以纳秒为精度的小数点',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-15 00:12:10',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://xiaoaozz.github.io/" title="个人博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="个人博客"/><span class="back-menu-item-text">个人博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/xiaoaozz" title="Github"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/104616274?v=4" alt="Github"/><span class="back-menu-item-text">Github</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">小奥</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="微信" src="/null"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/null"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AQS/" style="font-size: 1.05rem;">AQS<sup>1</sup></a><a href="/tags/ArrayList/" style="font-size: 1.05rem;">ArrayList<sup>1</sup></a><a href="/tags/BigDecimal/" style="font-size: 1.05rem;">BigDecimal<sup>1</sup></a><a href="/tags/Feed%E6%B5%81/" style="font-size: 1.05rem;">Feed流<sup>1</sup></a><a href="/tags/Go%E9%9D%A2%E7%BB%8F/" style="font-size: 1.05rem;">Go面经<sup>1</sup></a><a href="/tags/HashMap/" style="font-size: 1.05rem;">HashMap<sup>1</sup></a><a href="/tags/JDK8/" style="font-size: 1.05rem;">JDK8<sup>1</sup></a><a href="/tags/Java%E9%9D%A2%E7%BB%8F/" style="font-size: 1.05rem;">Java面经<sup>1</sup></a><a href="/tags/LinkedList/" style="font-size: 1.05rem;">LinkedList<sup>1</sup></a><a href="/tags/MySQL%E4%BC%98%E5%8C%96/" style="font-size: 1.05rem;">MySQL优化<sup>2</sup></a><a href="/tags/MySQL%E5%BA%94%E7%94%A8/" style="font-size: 1.05rem;">MySQL应用<sup>1</sup></a><a href="/tags/MySQL%E9%9D%A2%E7%BB%8F/" style="font-size: 1.05rem;">MySQL面经<sup>1</sup></a><a href="/tags/OOM/" style="font-size: 1.05rem;">OOM<sup>1</sup></a><a href="/tags/RabbitMQ/" style="font-size: 1.05rem;">RabbitMQ<sup>1</sup></a><a href="/tags/Redission%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 1.05rem;">Redission分布式锁<sup>1</sup></a><a href="/tags/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 1.05rem;">Redis分布式锁<sup>1</sup></a><a href="/tags/ReentrantLock/" style="font-size: 1.05rem;">ReentrantLock<sup>1</sup></a><a href="/tags/Servlet/" style="font-size: 1.05rem;">Servlet<sup>1</sup></a><a href="/tags/Socket/" style="font-size: 1.05rem;">Socket<sup>2</sup></a><a href="/tags/SpringCloud/" style="font-size: 1.05rem;">SpringCloud<sup>1</sup></a><a href="/tags/StopWatch/" style="font-size: 1.05rem;">StopWatch<sup>1</sup></a><a href="/tags/synchronized/" style="font-size: 1.05rem;">synchronized<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" style="font-size: 1.05rem;">分布式事务<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">并发<sup>1</sup></a><a href="/tags/%E6%8E%A5%E5%8F%A3%E9%99%90%E6%B5%81/" style="font-size: 1.05rem;">接口限流<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size: 1.05rem;">文件上传<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/" style="font-size: 1.05rem;">算法模板<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%9D%A2%E7%BB%8F/" style="font-size: 1.05rem;">计算机网络面经<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">24</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">十二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url">系统设计</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/StopWatch/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>StopWatch</span></a></span></div></div><h1 class="post-title" itemprop="name headline">StopWatch使用详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-01-14T14:36:52.000Z" title="发表于 2024-01-14 22:36:52">2024-01-14</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-01-14T16:12:10.185Z" title="更新于 2024-01-15 00:12:10">2024-01-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为河南"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>河南</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/png/7.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2024/01/14/StopWatch%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"><header><a class="post-meta-categories" href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url">系统设计</a><a href="/tags/StopWatch/" tabindex="-1" itemprop="url">StopWatch</a><h1 id="CrawlerTitle" itemprop="name headline">StopWatch使用详解</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">小奥</span><time itemprop="dateCreated datePublished" datetime="2024-01-14T14:36:52.000Z" title="发表于 2024-01-14 22:36:52">2024-01-14</time><time itemprop="dateCreated datePublished" datetime="2024-01-14T16:12:10.185Z" title="更新于 2024-01-15 00:12:10">2024-01-15</time></header><h1 id="StopWatch使用详解"><a href="#StopWatch使用详解" class="headerlink" title="StopWatch使用详解"></a>StopWatch使用详解</h1><p>当我们需要测试代码性能的时候，你是否第一时间快速的敲出如下代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">      test();</span><br><span class="line">      <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">      System.out.println(<span class="string">&quot;程序执行耗时：&quot;</span> + (end - start));</span><br></pre></td></tr></table></figure>

<p>这样的写法其实并不会有很大的问题，只是当我们需要测试的方法比较多，或者说交叉测试时，就会比较麻烦了。比如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">      test();</span><br><span class="line">      <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">      <span class="type">long</span> <span class="variable">start1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">      test1();</span><br><span class="line">      <span class="type">long</span> <span class="variable">end1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">      test2();</span><br><span class="line">      <span class="type">long</span> <span class="variable">end2</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">      System.out.println(<span class="string">&quot;test执行耗时：&quot;</span> + (end - start));</span><br><span class="line">      System.out.println(<span class="string">&quot;test1执行耗时：&quot;</span> + (end1 - start1));</span><br><span class="line">      System.out.println(<span class="string">&quot;test test1 test2执行耗时：&quot;</span> + (end - start));</span><br></pre></td></tr></table></figure>

<p>这样的代码看起来不仅繁琐，而且可读性很差。</p>
<p>所以我今天为大家介绍一个比较好用的计时工具<code>StopWatch</code>，下面让我们一起学习，一起早日用起来吧！</p>
<h1 id="一、认识StopWatch"><a href="#一、认识StopWatch" class="headerlink" title="一、认识StopWatch"></a>一、认识StopWatch</h1><p><code>stopWatch</code>是<code>org.springframework.util</code>包下的一个工具类，使用它可直观的输出代码执行耗时，以及执行时间百分比。</p>
<p>我们可以从源码注释上看到这个工具类的介绍：</p>
<blockquote>
<p>Simple stop watch, allowing for timing of a number of tasks, exposing total running time and running time for each named task.<br>Conceals use of System.nanoTime(), improving the readability of application code and reducing the likelihood of calculation errors.<br>Note that this object is not designed to be thread-safe and does not use synchronization.<br>This class is normally used to verify performance during proof-of-concept work and in development, rather than as part of production applications.<br>As of Spring Framework 5.2, running time is tracked and reported in nanoseconds. As of 6.1, the default time unit for String renderings is seconds with decimal points in nanosecond precision. Custom renderings with specific time units can be requested through prettyPrint(TimeUnit).</p>
<p>简单的秒表，允许对多个任务进行计时，显示总运行时间和每个指定任务的运行时间。<br><strong>隐藏System.nanoTime()的使用，提高应用程序代码的可读性，减少计算错误的可能性</strong>。<br>注意，这个<strong>对象不是被设计为线程安全的，也不使用同步</strong>。<br>该类通常用于在概念验证工作和开发过程中验证性能，而不是作为生产应用程序的一部分。<br>从Spring Framework 5.2开始，以纳秒为单位跟踪和报告运行时间。从6.1开始，字符串呈现的默认时间单位是秒，其小数点的精度为纳秒。具有特定时间单位的自定义渲染可以通过prettyPrint(TimeUnit)请求。</p>
</blockquote>
<p>这里有两点是需要我们注意的：</p>
<ul>
<li>隐藏System.nanoTime()的使用，提高应用程序代码的可读性，减少计算错误的可能性。</li>
<li>对象不是被设计为线程安全的，也不使用同步。</li>
</ul>
<p>下面我们来介绍一个这个工具的使用，以及会出现的线程安全问题，并且如何去解决该问题。</p>
<h2 id="1-1-单个任务测试"><a href="#1-1-单个任务测试" class="headerlink" title="1.1 单个任务测试"></a>1.1 单个任务测试</h2><p>我们可以调用<code>start()</code>和<code>stop()</code>方法来开始和结束计时，并且通过<code>getTotalTimeMillis()</code>来获取程序执行耗时。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">    stopWatch.start();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 这里使用线程休眠来模拟耗时程序</span></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    stopWatch.stop();</span><br><span class="line">    System.out.println(<span class="string">&quot;程序执行耗时：&quot;</span> + stopWatch.getTotalTimeMillis());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制台输出结果如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">程序执行耗时：<span class="number">1005</span></span><br></pre></td></tr></table></figure>

<p>可以看到，这和我们使用<code>System.currentTimeMillis()</code>是一样的，那么有小伙伴就要说了，这和直接使用<code>System.currentTimeMillis()</code>有什么区别吗？先别着急，让我们继续往下看。</p>
<h2 id="1-2-多任务测试并生成统计表"><a href="#1-2-多任务测试并生成统计表" class="headerlink" title="1.2 多任务测试并生成统计表"></a>1.2 多任务测试并生成统计表</h2><p>下面我们来看多任务测试，并且调用&#96;&#96;生成统计图表的测试代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line">       <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">       stopWatch.start(<span class="string">&quot;task1&quot;</span>);</span><br><span class="line">       Thread.sleep(<span class="number">1000</span>); <span class="comment">// 这里使用线程休眠来模拟耗时程序</span></span><br><span class="line">       stopWatch.stop();</span><br><span class="line">       stopWatch.start(<span class="string">&quot;task2&quot;</span>);</span><br><span class="line">       Thread.sleep(<span class="number">2000</span>); <span class="comment">// 这里使用线程休眠来模拟耗时程序</span></span><br><span class="line">       stopWatch.stop();</span><br><span class="line">       System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line">       System.out.println(stopWatch.prettyPrint());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>控制台输出如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StopWatch <span class="string">&#x27;test&#x27;</span>: <span class="number">3.0113144</span> seconds</span><br><span class="line">----------------------------------------</span><br><span class="line">Seconds       %       Task name</span><br><span class="line">----------------------------------------</span><br><span class="line"><span class="number">1.0051963</span>     <span class="number">33</span>%     task1</span><br><span class="line"><span class="number">2.0061181</span>     <span class="number">67</span>%     task2</span><br></pre></td></tr></table></figure>

<p>可以看到，不仅编写的代码可读性增强了，而且控制台输出结果也图表化了，更加的直观具体了。</p>
<p>并且我们也可以给不同的<code>StopWatch</code>进行命名，给不同的<code>task</code>命名以便区分不同程序的执行结果测试。</p>
<h2 id="1-3-优缺点"><a href="#1-3-优缺点" class="headerlink" title="1.3 优缺点"></a>1.3 优缺点</h2><blockquote>
<p>优点</p>
</blockquote>
<ul>
<li>Spring自带工具类，无需三方引入，开箱即用</li>
<li>使用简单，方便</li>
<li>结果格式化输出，展示每项任务耗时与占用时间百分比，结果更加直观</li>
<li>可自定义任务名称，方便查看结果</li>
</ul>
<blockquote>
<p>缺点</p>
</blockquote>
<ul>
<li>一个<code>StopWatch</code>实例一次只能开启一个<code>task</code>，并且需要等<code>stop</code>之后才能<code>start</code>新的<code>task</code>。</li>
<li>代码侵入式使用</li>
</ul>
<blockquote>
<p>注意：单线程使用！！！</p>
</blockquote>
<p><code>StopWatch</code>的源码注释中有明确提到：</p>
<blockquote>
<p>注意，这个<strong>对象不是被设计为线程安全的，也不使用同步</strong>。<br>该类通常用于在概念验证工作和开发过程中验证性能，而不是作为生产应用程序的一部分。</p>
</blockquote>
<h1 id="二、源码解析"><a href="#二、源码解析" class="headerlink" title="二、源码解析"></a>二、源码解析</h1><p>下面让我们分析一下的<code>StopWatch</code>的源码。</p>
<h2 id="2-1-成员变量"><a href="#2-1-成员变量" class="headerlink" title="2.1 成员变量"></a>2.1 成员变量</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 秒表的标识符。</span></span><br><span class="line"><span class="comment"> * 当我们有多个秒表的输出并需要在日志或控制台输出中区分它们时，这很方便。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 任务列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> List&lt;TaskInfo&gt; taskList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 当前任务的开始时间。 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> startTimeNanos;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 当前任务的名称。 */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> String currentTaskName;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> TaskInfo lastTaskInfo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 任务数量。 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> taskCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 总运行时间。 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> totalTimeNanos;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-start"><a href="#2-2-start" class="headerlink" title="2.2 start()"></a>2.2 start()</h2><p><code>start()</code>方法的逻辑如下：</p>
<ul>
<li>首先判断当前的计时任务是否停止（<code>currentTaskName</code>标志了计时器是否正在被某个任务占用，<code>isRunning()</code>方法也表明了这一点）：<ul>
<li><code>currentTaskName</code>不为空，计时器正在被某个任务占用，抛出异常；</li>
<li><code>currentTaskName</code>为空，计时器重新计时；</li>
</ul>
</li>
<li>设置当前任务名称<code>currentTaskName</code>。</li>
<li>设置任务开始时间<code>startTimeNanos</code>，使用<code>System.nanoTime()</code>来测量每个Task耗时。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动一个未命名的任务。</span></span><br><span class="line"><span class="comment"> * 如果在不首先调用此方法的情况下调用stop()或计时方法，则结果是未定义的。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">	start(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动一个命名任务。</span></span><br><span class="line"><span class="comment"> * 如果在不首先调用此方法的情况下调用stop()或计时方法，则结果是未定义的。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(String taskName)</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">this</span>.currentTaskName != <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Can&#x27;t start StopWatch: it&#x27;s already running&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">this</span>.currentTaskName = taskName;</span><br><span class="line">	<span class="built_in">this</span>.startTimeNanos = System.nanoTime(); <span class="comment">// 将当前时间赋值给startTimeNanos，注意这里用的是纳秒级别</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-stop"><a href="#2-3-stop" class="headerlink" title="2.3 stop()"></a>2.3 stop()</h2><p><code>stop()</code>方法的逻辑如下：</p>
<ul>
<li>首先判断当前的计时任务是否停止（<code>currentTaskName</code>标志了计时器是否正在被某个任务占用，<code>isRunning()</code>方法也表明了这一点）：<ul>
<li><code>currentTaskName</code>不为空，有进行中的测量的任务；</li>
<li><code>currentTaskName</code>为空，没有进行中的测量的任务，抛出异常；</li>
</ul>
</li>
<li>计算<code>lastTime</code>：<code>System.nanoTime() - this.startTimeNanos; </code></li>
<li>计算<code>totalTimeNanos</code>：<code>this.totalTimeNanos += lastTime;</code></li>
<li>结束任务，构造任务测量结果，存放到任务列表中<ul>
<li>构造<code>TaskInfo</code>对象</li>
<li>判断该对象是否拓展<code>taskList</code>集合中<ul>
<li>是，存放在<code>taskList</code>集合中</li>
<li>否，跳过，放弃本次任务收集</li>
</ul>
</li>
<li><code>currentTaskName</code>置为null</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 停止当前任务。</span></span><br><span class="line"><span class="comment"> * 如果在没有调用至少一对start() / stop()方法的情况下调用计时方法，则结果是未定义的。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">this</span>.currentTaskName == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Can&#x27;t stop StopWatch: it&#x27;s not running&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">long</span> <span class="variable">lastTime</span> <span class="operator">=</span> System.nanoTime() - <span class="built_in">this</span>.startTimeNanos; <span class="comment">// 这里是计算耗时的逻辑</span></span><br><span class="line">	<span class="built_in">this</span>.totalTimeNanos += lastTime;</span><br><span class="line">	<span class="built_in">this</span>.lastTaskInfo = <span class="keyword">new</span> <span class="title class_">TaskInfo</span>(<span class="built_in">this</span>.currentTaskName, lastTime);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">this</span>.taskList != <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="built_in">this</span>.taskList.add(<span class="built_in">this</span>.lastTaskInfo);</span><br><span class="line">	&#125;</span><br><span class="line">	++<span class="built_in">this</span>.taskCount;</span><br><span class="line">	<span class="built_in">this</span>.currentTaskName = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="四、完整源码"><a href="#四、完整源码" class="headerlink" title="四、完整源码"></a>四、完整源码</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.NumberFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单的秒表，允许对多个任务进行计时，显示总运行时间和每个指定任务的运行时间。</span></span><br><span class="line"><span class="comment"> * 隐藏System.nanoTime()的使用，提高应用程序代码的可读性，减少计算错误的可能性。</span></span><br><span class="line"><span class="comment"> * 注意，这个对象不是被设计为线程安全的，也不使用同步。</span></span><br><span class="line"><span class="comment"> * 该类通常用于在概念验证工作和开发过程中验证性能，而不是作为生产应用程序的一部分。</span></span><br><span class="line"><span class="comment"> * 从Spring Framework 5.2开始，以纳秒为单位跟踪和报告运行时间。</span></span><br><span class="line"><span class="comment"> * 从6.1开始，字符串呈现的默认时间单位是秒，其小数点的精度为纳秒。</span></span><br><span class="line"><span class="comment"> * 具有特定时间单位的自定义渲染可以通过prettyPrint(TimeUnit)请求。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StopWatch</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 秒表的标识符。</span></span><br><span class="line"><span class="comment">	 * 当我们有多个秒表的输出并需要在日志或控制台输出中区分它们时，这很方便。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;TaskInfo&gt; taskList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当前任务的开始时间。 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> startTimeNanos;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当前任务的名称。 */</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">private</span> String currentTaskName;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">private</span> TaskInfo lastTaskInfo;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> taskCount;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 总运行时间。 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> totalTimeNanos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造一个新的秒表。</span></span><br><span class="line"><span class="comment">	 * 不启动任何任务。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">StopWatch</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用给定的id构造一个新的秒表。</span></span><br><span class="line"><span class="comment">	 * 当我们有多个秒表的输出并需要区分它们时，id很方便。</span></span><br><span class="line"><span class="comment">	 * 不启动任何任务。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">StopWatch</span><span class="params">(String id)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取在构造中指定的StopWatch的id。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置秒表是否。</span></span><br><span class="line"><span class="comment">	 * TaskInfo数组是随着时间构建的。当使用秒表执行数百万个任务时，将此设置为false;否则，TaskInfo结构会占用过多的内存。</span></span><br><span class="line"><span class="comment">	 * 默认为true。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setKeepTaskList</span><span class="params">(<span class="type">boolean</span> keepTaskList)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.taskList = (keepTaskList ? <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;() : <span class="literal">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 启动一个未命名的任务。</span></span><br><span class="line"><span class="comment">	 * 如果在不首先调用此方法的情况下调用stop()或计时方法，则结果是未定义的。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">		start(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 启动一个命名任务。</span></span><br><span class="line"><span class="comment">	 * 如果在不首先调用此方法的情况下调用stop()或计时方法，则结果是未定义的。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(String taskName)</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.currentTaskName != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Can&#x27;t start StopWatch: it&#x27;s already running&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">this</span>.currentTaskName = taskName;</span><br><span class="line">		<span class="built_in">this</span>.startTimeNanos = System.nanoTime();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 停止当前任务。</span></span><br><span class="line"><span class="comment">	 * 如果在没有调用至少一对start() / stop()方法的情况下调用计时方法，则结果是未定义的。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.currentTaskName == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Can&#x27;t stop StopWatch: it&#x27;s not running&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">long</span> <span class="variable">lastTime</span> <span class="operator">=</span> System.nanoTime() - <span class="built_in">this</span>.startTimeNanos;</span><br><span class="line">		<span class="built_in">this</span>.totalTimeNanos += lastTime;</span><br><span class="line">		<span class="built_in">this</span>.lastTaskInfo = <span class="keyword">new</span> <span class="title class_">TaskInfo</span>(<span class="built_in">this</span>.currentTaskName, lastTime);</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.taskList != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="built_in">this</span>.taskList.add(<span class="built_in">this</span>.lastTaskInfo);</span><br><span class="line">		&#125;</span><br><span class="line">		++<span class="built_in">this</span>.taskCount;</span><br><span class="line">		<span class="built_in">this</span>.currentTaskName = <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 确定秒表当前是否正在运行。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isRunning</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="built_in">this</span>.currentTaskName != <span class="literal">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取当前运行任务的名称(如果有)。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">currentTaskName</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.currentTaskName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 把最后一个任务作为StopWatch.TaskInfo对象。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> TaskInfo <span class="title function_">lastTaskInfo</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">		Assert.state(<span class="built_in">this</span>.lastTaskInfo != <span class="literal">null</span>, <span class="string">&quot;No tasks run&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.lastTaskInfo;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 把最后一个任务作为StopWatch.TaskInfo对象。</span></span><br><span class="line"><span class="comment">	 * 弃用从6.1开始，支持lastTaskInfo()</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Deprecated(since = &quot;6.1&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> TaskInfo <span class="title function_">getLastTaskInfo</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">		<span class="keyword">return</span> lastTaskInfo();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取最后一个任务的名称。</span></span><br><span class="line"><span class="comment">	 * 弃用从6.1开始，支持lastTaskInfo()</span></span><br><span class="line"><span class="comment">	 * 可以查看StopWatch.TaskInfo.getTaskName()</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Deprecated(since = &quot;6.1&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getLastTaskName</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">		<span class="keyword">return</span> lastTaskInfo().getTaskName();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取最后一个任务花费的时间(以纳秒为单位)。</span></span><br><span class="line"><span class="comment">	 * 弃用从6.1开始，支持lastTaskInfo()</span></span><br><span class="line"><span class="comment">	 * 可以查看StopWatch.TaskInfo.getTimeNanos()</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Deprecated(since = &quot;6.1&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getLastTaskTimeNanos</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">		<span class="keyword">return</span> lastTaskInfo().getTimeNanos();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取最后一个任务所花费的时间(以毫秒为单位)。</span></span><br><span class="line"><span class="comment">	 * 弃用从6.1开始，支持lastTaskInfo()</span></span><br><span class="line"><span class="comment">	 * 可以查看StopWatch.TaskInfo.getTimeMillis()</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Deprecated(since = &quot;6.1&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getLastTaskTimeMillis</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">		<span class="keyword">return</span> lastTaskInfo().getTimeMillis();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取已执行任务的数据数组。</span></span><br><span class="line"><span class="comment">	 * 可以查看setKeepTaskList</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> TaskInfo[] getTaskInfo() &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.taskList == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;Task info is not being kept!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.taskList.toArray(<span class="keyword">new</span> <span class="title class_">TaskInfo</span>[<span class="number">0</span>]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取计时的任务数。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTaskCount</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.taskCount;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取所有任务的总时间(以纳秒为单位)。</span></span><br><span class="line"><span class="comment">	 * 可以查看getTotalTime(TimeUnit)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTotalTimeNanos</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.totalTimeNanos;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取所有任务的总时间(以毫秒为单位)。</span></span><br><span class="line"><span class="comment">	 * 可以查看getTotalTime(TimeUnit)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTotalTimeMillis</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> TimeUnit.NANOSECONDS.toMillis(<span class="built_in">this</span>.totalTimeNanos);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 以秒为单位获取所有任务的总时间。</span></span><br><span class="line"><span class="comment">	 * 可以查看getTotalTime(TimeUnit)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTotalTimeSeconds</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> getTotalTime(TimeUnit.SECONDS);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 以请求的时间单位获取所有任务的总时间(以纳秒为精度的小数点)。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTotalTime</span><span class="params">(TimeUnit timeUnit)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="type">double</span>) <span class="built_in">this</span>.totalTimeNanos / TimeUnit.NANOSECONDS.convert(<span class="number">1</span>, timeUnit);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 生成一个表，描述以秒为单位执行的所有任务(以纳秒为精度的小数点)。</span></span><br><span class="line"><span class="comment">	 * 对于自定义报告，调用getTaskInfo()并直接使用数据。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">prettyPrint</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> prettyPrint(TimeUnit.SECONDS);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 生成一个表，描述在请求的时间单位内执行的所有任务(以纳秒为精度的小数点)。</span></span><br><span class="line"><span class="comment">	 * 对于自定义报告，调用getTaskInfo()并直接使用数据。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">prettyPrint</span><span class="params">(TimeUnit timeUnit)</span> &#123;</span><br><span class="line">		<span class="type">NumberFormat</span> <span class="variable">nf</span> <span class="operator">=</span> NumberFormat.getNumberInstance(Locale.ENGLISH);</span><br><span class="line">		nf.setMaximumFractionDigits(<span class="number">9</span>);</span><br><span class="line">		nf.setGroupingUsed(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">		<span class="type">NumberFormat</span> <span class="variable">pf</span> <span class="operator">=</span> NumberFormat.getPercentInstance(Locale.ENGLISH);</span><br><span class="line">		pf.setMinimumIntegerDigits(<span class="number">2</span>);</span><br><span class="line">		pf.setGroupingUsed(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="number">128</span>);</span><br><span class="line">		sb.append(<span class="string">&quot;StopWatch &#x27;&quot;</span>).append(getId()).append(<span class="string">&quot;&#x27;: &quot;</span>);</span><br><span class="line">		<span class="type">String</span> <span class="variable">total</span> <span class="operator">=</span> (timeUnit == TimeUnit.NANOSECONDS ?</span><br><span class="line">				nf.format(getTotalTimeNanos()) : nf.format(getTotalTime(timeUnit)));</span><br><span class="line">		sb.append(total).append(<span class="string">&quot; &quot;</span>).append(timeUnit.name().toLowerCase(Locale.ENGLISH));</span><br><span class="line">		<span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> Math.max(sb.length(), <span class="number">40</span>);</span><br><span class="line">		sb.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.taskList != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="string">&quot;-&quot;</span>.repeat(width) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">			<span class="type">String</span> <span class="variable">unitName</span> <span class="operator">=</span> timeUnit.name();</span><br><span class="line">			unitName = unitName.charAt(<span class="number">0</span>) + unitName.substring(<span class="number">1</span>).toLowerCase(Locale.ENGLISH);</span><br><span class="line">			unitName = String.format(<span class="string">&quot;%-12s&quot;</span>, unitName);</span><br><span class="line">			sb.append(line);</span><br><span class="line">			sb.append(unitName).append(<span class="string">&quot;  %       Task name\n&quot;</span>);</span><br><span class="line">			sb.append(line);</span><br><span class="line"></span><br><span class="line">			<span class="type">int</span> <span class="variable">digits</span> <span class="operator">=</span> total.indexOf(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">			<span class="keyword">if</span> (digits &lt; <span class="number">0</span>) &#123;</span><br><span class="line">				digits = total.length();</span><br><span class="line">			&#125;</span><br><span class="line">			nf.setMinimumIntegerDigits(digits);</span><br><span class="line">			nf.setMaximumFractionDigits(<span class="number">10</span> - digits);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (TaskInfo task : <span class="built_in">this</span>.taskList) &#123;</span><br><span class="line">				sb.append(String.format(<span class="string">&quot;%-14s&quot;</span>, (timeUnit == TimeUnit.NANOSECONDS ?</span><br><span class="line">						nf.format(task.getTimeNanos()) : nf.format(task.getTime(timeUnit)))));</span><br><span class="line">				sb.append(String.format(<span class="string">&quot;%-8s&quot;</span>,</span><br><span class="line">						pf.format(task.getTimeSeconds() / getTotalTimeSeconds())));</span><br><span class="line">				sb.append(task.getTaskName()).append(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			sb.append(<span class="string">&quot;No task info kept&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> sb.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取以秒为单位的总运行时间的简短描述。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">shortSummary</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;StopWatch &#x27;&quot;</span> + getId() + <span class="string">&quot;&#x27;: &quot;</span> + getTotalTimeSeconds() + <span class="string">&quot; seconds&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 生成一个信息字符串，描述在几秒钟内执行的所有任务。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(shortSummary());</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.taskList != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (TaskInfo task : <span class="built_in">this</span>.taskList) &#123;</span><br><span class="line">				sb.append(<span class="string">&quot;; [&quot;</span>).append(task.getTaskName()).append(<span class="string">&quot;] took &quot;</span>).append(task.getTimeSeconds()).append(<span class="string">&quot; seconds&quot;</span>);</span><br><span class="line">				<span class="type">long</span> <span class="variable">percent</span> <span class="operator">=</span> Math.round(<span class="number">100.0</span> * task.getTimeSeconds() / getTotalTimeSeconds());</span><br><span class="line">				sb.append(<span class="string">&quot; = &quot;</span>).append(percent).append(<span class="string">&#x27;%&#x27;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			sb.append(<span class="string">&quot;; no task info kept&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sb.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 嵌套类，用于保存在StopWatch中执行的一个任务的数据。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TaskInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> String taskName;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> timeNanos;</span><br><span class="line"></span><br><span class="line">		TaskInfo(String taskName, <span class="type">long</span> timeNanos) &#123;</span><br><span class="line">			<span class="built_in">this</span>.taskName = taskName;</span><br><span class="line">			<span class="built_in">this</span>.timeNanos = timeNanos;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 获取该任务的名称</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">public</span> String <span class="title function_">getTaskName</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>.taskName;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 获取此任务花费的时间(以纳秒为单位)</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTimeNanos</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>.timeNanos;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 获取此任务花费的时间(以豪秒为单位)</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTimeMillis</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> TimeUnit.NANOSECONDS.toMillis(<span class="built_in">this</span>.timeNanos);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 获取此任务花费的时间(以秒为单位)</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTimeSeconds</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> getTime(TimeUnit.SECONDS);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 以请求的时间单位获取此任务所花费的时间(以纳秒为精度的小数点)。</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTime</span><span class="params">(TimeUnit timeUnit)</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> (<span class="type">double</span>) <span class="built_in">this</span>.timeNanos / TimeUnit.NANOSECONDS.convert(<span class="number">1</span>, timeUnit);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">小奥</div><div class="post-copyright__author_desc">浮生若梦 为欢几何</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2024/01/14/StopWatch%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2024/01/14/StopWatch%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/')">StopWatch使用详解</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2024/01/14/StopWatch%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=StopWatch使用详解&amp;url=http://example.com/2024/01/14/StopWatch%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/&amp;pic=/img/png/7.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">小奥</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>系统设计<span class="categoryesPageCount">4</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/StopWatch/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>StopWatch<span class="tagsPageCount">1</span></a></div></div><div class="post_share"><div class="social-share" data-image="/img/png/8.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/01/14/RabbitMQ%E4%BD%BF%E7%94%A8%E7%AF%87/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/png/3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">RabbitMQ使用篇</div></div></a></div><div class="next-post pull-right"><a href="/2024/01/15/Java%E4%B8%AD%E7%9A%84Socket%E4%BD%A0%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/png/11.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Java中的Socket你了解吗？</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">Java、数据库、中间件</b>相关的学习笔记，还有<b style="color:#fff">面试题总结</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">小奥</h1><div class="author-info__desc">浮生若梦 为欢几何</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/xiaoaozz" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#StopWatch%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">StopWatch使用详解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%AE%A4%E8%AF%86StopWatch"><span class="toc-number">2.</span> <span class="toc-text">一、认识StopWatch</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%8D%95%E4%B8%AA%E4%BB%BB%E5%8A%A1%E6%B5%8B%E8%AF%95"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 单个任务测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E6%B5%8B%E8%AF%95%E5%B9%B6%E7%94%9F%E6%88%90%E7%BB%9F%E8%AE%A1%E8%A1%A8"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 多任务测试并生成统计表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 优缺点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">二、源码解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 成员变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-start"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 start()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-stop"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 stop()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%AE%8C%E6%95%B4%E6%BA%90%E7%A0%81"><span class="toc-number">4.</span> <span class="toc-text">四、完整源码</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/02/04/Java%E5%B9%B6%E5%8F%91%E4%B9%8Bsynchronized%E8%AF%A6%E8%A7%A3/" title="Java并发之synchronized详解"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/png/8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java并发之synchronized详解"/></a><div class="content"><a class="title" href="/2024/02/04/Java%E5%B9%B6%E5%8F%91%E4%B9%8Bsynchronized%E8%AF%A6%E8%A7%A3/" title="Java并发之synchronized详解">Java并发之synchronized详解</a><time datetime="2024-02-04T12:26:07.000Z" title="发表于 2024-02-04 20:26:07">2024-02-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/29/Java%E5%B9%B6%E5%8F%91%E4%B9%8BAQS%E6%BA%90%E7%A0%81%E7%AF%87/" title="Java并发之AQS源码篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/png/3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java并发之AQS源码篇"/></a><div class="content"><a class="title" href="/2024/01/29/Java%E5%B9%B6%E5%8F%91%E4%B9%8BAQS%E6%BA%90%E7%A0%81%E7%AF%87/" title="Java并发之AQS源码篇">Java并发之AQS源码篇</a><time datetime="2024-01-29T12:26:17.000Z" title="发表于 2024-01-29 20:26:17">2024-01-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/28/Java%E5%B9%B6%E5%8F%91%E4%B9%8BReentrantLock%E6%BA%90%E7%A0%81%E7%AF%87/" title="Java并发之ReentrantLock源码篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/png/22.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java并发之ReentrantLock源码篇"/></a><div class="content"><a class="title" href="/2024/01/28/Java%E5%B9%B6%E5%8F%91%E4%B9%8BReentrantLock%E6%BA%90%E7%A0%81%E7%AF%87/" title="Java并发之ReentrantLock源码篇">Java并发之ReentrantLock源码篇</a><time datetime="2024-01-28T12:08:06.000Z" title="发表于 2024-01-28 20:08:06">2024-01-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/25/%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5%E5%92%8C%E8%A7%A3%E5%86%B3OOM/" title="带你学习如何排查和解决OOM"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/png/5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="带你学习如何排查和解决OOM"/></a><div class="content"><a class="title" href="/2024/01/25/%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5%E5%92%8C%E8%A7%A3%E5%86%B3OOM/" title="带你学习如何排查和解决OOM">带你学习如何排查和解决OOM</a><time datetime="2024-01-25T12:18:47.000Z" title="发表于 2024-01-25 20:18:47">2024-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/22/Java%E4%B9%8BBigDecimal%E4%BD%BF%E7%94%A8%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF/" title="Java之BigDecimal使用正确姿势"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/png/22.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java之BigDecimal使用正确姿势"/></a><div class="content"><a class="title" href="/2024/01/22/Java%E4%B9%8BBigDecimal%E4%BD%BF%E7%94%A8%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF/" title="Java之BigDecimal使用正确姿势">Java之BigDecimal使用正确姿势</a><time datetime="2024-01-22T13:51:24.000Z" title="发表于 2024-01-22 21:51:24">2024-01-22</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="小奥" target="_blank">小奥</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">31</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">12</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://xiaoaozz.github.io/" title="个人博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="个人博客"/><span class="back-menu-item-text">个人博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/xiaoaozz" title="Github"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/104616274?v=4" alt="Github"/><span class="back-menu-item-text">Github</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AQS/" style="font-size: 0.88rem;">AQS<sup>1</sup></a><a href="/tags/ArrayList/" style="font-size: 0.88rem;">ArrayList<sup>1</sup></a><a href="/tags/BigDecimal/" style="font-size: 0.88rem;">BigDecimal<sup>1</sup></a><a href="/tags/Feed%E6%B5%81/" style="font-size: 0.88rem;">Feed流<sup>1</sup></a><a href="/tags/Go%E9%9D%A2%E7%BB%8F/" style="font-size: 0.88rem;">Go面经<sup>1</sup></a><a href="/tags/HashMap/" style="font-size: 0.88rem;">HashMap<sup>1</sup></a><a href="/tags/JDK8/" style="font-size: 0.88rem;">JDK8<sup>1</sup></a><a href="/tags/Java%E9%9D%A2%E7%BB%8F/" style="font-size: 0.88rem;">Java面经<sup>1</sup></a><a href="/tags/LinkedList/" style="font-size: 0.88rem;">LinkedList<sup>1</sup></a><a href="/tags/MySQL%E4%BC%98%E5%8C%96/" style="font-size: 0.88rem;">MySQL优化<sup>2</sup></a><a href="/tags/MySQL%E5%BA%94%E7%94%A8/" style="font-size: 0.88rem;">MySQL应用<sup>1</sup></a><a href="/tags/MySQL%E9%9D%A2%E7%BB%8F/" style="font-size: 0.88rem;">MySQL面经<sup>1</sup></a><a href="/tags/OOM/" style="font-size: 0.88rem;">OOM<sup>1</sup></a><a href="/tags/RabbitMQ/" style="font-size: 0.88rem;">RabbitMQ<sup>1</sup></a><a href="/tags/Redission%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 0.88rem;">Redission分布式锁<sup>1</sup></a><a href="/tags/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 0.88rem;">Redis分布式锁<sup>1</sup></a><a href="/tags/ReentrantLock/" style="font-size: 0.88rem;">ReentrantLock<sup>1</sup></a><a href="/tags/Servlet/" style="font-size: 0.88rem;">Servlet<sup>1</sup></a><a href="/tags/Socket/" style="font-size: 0.88rem;">Socket<sup>2</sup></a><a href="/tags/SpringCloud/" style="font-size: 0.88rem;">SpringCloud<sup>1</sup></a><a href="/tags/StopWatch/" style="font-size: 0.88rem;">StopWatch<sup>1</sup></a><a href="/tags/synchronized/" style="font-size: 0.88rem;">synchronized<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" style="font-size: 0.88rem;">分布式事务<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">并发<sup>1</sup></a><a href="/tags/%E6%8E%A5%E5%8F%A3%E9%99%90%E6%B5%81/" style="font-size: 0.88rem;">接口限流<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size: 0.88rem;">文件上传<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/" style="font-size: 0.88rem;">算法模板<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%9D%A2%E7%BB%8F/" style="font-size: 0.88rem;">计算机网络面经<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8956954060&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 小奥 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>